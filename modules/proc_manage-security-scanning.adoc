[[quay-security-scanner]]
= {productname} Security Scanning with Clair

{productname} supports scanning container images for known
vulnerabilities with a scanning engine such as link:https://github.com/coreos/clair/[Clair].
This document explains how to configure Clair with Quay.

[id='visit-the-management-panel_{context}']
== Visit {productname} Setup

To enable Clair security scanning in {productname}, whether at deployment time or
on a running {productname} cluster, you need to start the quay container in
config mode to begin using the {productname} Setup screen. See the appropriate {productname}
deployment procedure for how to do that.

Once {productname} Setup is running, make the appropriate selection: either start a new
configuration or modify an existing one. Scroll down that page until you see
the Security Scanner section. A configured Security Scanner should appear
as shown in the following figure:

image:../../images/security-scanner-enabled.png[Configure Clair from the {productname} config tool]

[[enable-security-scanning]]

Procedures for enabling Clair security scanning in {productname} are
described in the following sections.

== Enable Clair in {productname} on OpenShift deployments
To deploy Clair on OpenShift, see link:https://access.redhat.com/documentation/en-us/red_hat_quay/3/html-single/deploy_red_hat_quay_on_openshift/index#add-clair-scanner[Adding Clair image scanning to {productname}.

== Enable Clair in other {productname} deployments
To deploy Clair on basic and high availability deployments (non-OpenShift),
start the {productname} Setup configuration tool, then do the following:

* Scroll down to the section entitled
*Security Scanner*.
image:../../images/security-scanning-enabled.png[Enable scanning from superuser account]

* Check the "Enable Security Scanning" box

[[enter-a-security-scanner]]
== Enter a security scanner

In the "Security Scanner Endpoint" field, enter the HTTP endpoint of a
{productname}-compatible security scanner such as
link:clair-initial-setup[Clair].
image:../../images/security-scanner-endpoint.png[Enter location of security scanner]

[[generate-an-auth-key]]
== Generate an auth key

To connect {productname} securely to the scanner, click "Create Key >"
to create an authentication key between Quay and the Security Scanner.

[[authentication-for-high-availability-scanners]]
=== Authentication for high-availability scanners

If the security scanning engine is running on multiple instances in a
high-availability setup, select "Generate shared key":
image:../../images/security-scanner-generate-shared.png[Select key for security scanner]

Enter an optional expiration date, and click "Generate Key":
image:../../images/security-scanner-generate-shared-dialog.png[Generate key for security scanner]

*Save the key ID and download the preshared private key into the
configuration directory for the security scanning engine.*
image:../../images/security-scanner-shared-key.png[Generate key for security scanner]

[[authentication-for-single-instance-scanners]]
=== Authentication for single-instance scanners

If the security scanning engine is being run on a single instance,
select "Have the service provide a key":
image:../../images/security-scanner-service-provide-key.png[Provide key for security scanner]

Once the following dialog is visible, run the security scanning engine:
image:../../images/security-scanner-service-awaiting-key.png[Run security scanner]

When the security scanning engine connects, the key will be
automatically approved.

[id='save-configuration_{context}']
== Save configuration

* Click "Save Configuration Changes"
* Restart the container (you will be prompted)
